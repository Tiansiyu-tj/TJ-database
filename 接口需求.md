# 后端接口需求说明（嘉定出行 & 地铁导航项目）

本文档列出当前前端中“写死”的数据，以及对应建议的后端 API 设计，供后端与数据库同学参考。

---

## 1. 嘉定智能出行决策（Commute 页面）

### 1.1 校区出行时刻表（短驳 / 公交 / 教职班车）

**当前写死位置**

- 文件：`src/data/commuteData.js`
- 对象：`busSchedules`
- 内容：按线路、方向和日型写死了完整的发车时间数组，如：

busSchedules = {
  dz1: {
    campusToStation: { weekday: ['07:10', ...], weekend: [...] },
    stationToCampus: {...}
  },
  beian: {...},
  bus822: {...},
  teacher: {...}
}**建议 API**

GET /api/commute/schedules**Query 参数**

- `campus`: `string`，例如 `"jiading"`
- `routeKey`: `string`，`"dz1" | "beian" | "bus822" | "teacher"`
- `dayType`: `string`，`"weekday" | "weekend"`
- `direction`: `string`，`"campusToStation" | "stationToCampus"`

**Response 200**

{
  "code": 0,
  "message": "",
  "data": {
    "campus": "jiading",
    "routeKey": "bus822",
    "dayType": "weekday",
    "direction": "campusToStation",
    "times": ["05:05", "06:08", "06:48", "07:09", "07:18", "07:29"]
  }
}> 前端用 `times` 与当前时间比较，做“下一班倒计时”和表格高亮（已过红色、未到绿色）。

---

### 1.2 11/14 号线全天拥挤度曲线（0–1）

**当前写死位置**

- 文件：`src/data/commuteData.js`
- 对象：`congestionProfiles`
- 内容：`line11` / `line14` 每小时一个拥挤度系数：

congestionProfiles = {
  line11: [0.35, 0.32, ..., 0.38],
  line14: [0.18, 0.16, ..., 0.20]
}**建议 API**

GET /api/metro/congestion/profiles**Query 参数**

- `lines`: `string`，逗号分隔，例如 `"11,14"`
- `date`: `string`，`YYYY-MM-DD`，可选

**Response 200**

{
  "code": 0,
  "message": "",
  "data": [
    {
      "line": "11",
      "hours": ["00:00", "01:00", "02:00", "...", "23:00"],
      "congestion": [0.35, 0.32, 0.30, 0.32, 0.38]
    },
    {
      "line": "14",
      "hours": ["00:00", "01:00", "...", "23:00"],
      "congestion": [0.18, 0.16, 0.15, 0.18, 0.20]
    }
  ]
}---

### 1.3 路径元数据（步行距离 / 地铁基础时间 / 接驳方式）

**当前写死位置**

- 文件：`src/data/commuteData.js`
- 对象：`lineMeta`
- 内容：以路径为单位写死：

lineMeta = {
  line11: {
    name: "路径 A · 11号线安亭",
    color: "#ef4444",
    baseMetroMinutes: 38,
    walkSteps: 820,
    shuttleKey: "beian",
    description: "嘉定校区 → 北安跨线 → 11号线安亭方向 → 真如"
  },
  line14: {...}
}**建议 API**

GET /api/commute/routeMeta **Response 200**

{
  "code": 0,
  "message": "",
  "data": [
    {
      "lineKey": "line11",
      "displayName": "路径 A · 11号线安亭",
      "color": "#ef4444",
      "defaultMetroMinutes": 38,
      "walkSteps": 820,
      "shuttleKey": "beian",
      "descriptionTemplate": "嘉定校区 → 北安跨线 → 11号线安亭方向 → {{destination}}"
    },
    {
      "lineKey": "line14",
      "displayName": "路径 B · 14号线封浜",
      "color": "#22c55e",
      "defaultMetroMinutes": 30,
      "walkSteps": 420,
      "shuttleKey": "bus822",
      "descriptionTemplate": "嘉定校区 → 822/DZ1 → 封浜 → 14号线 → {{destination}}"
    }
  ]
}---

### 1.4 不同终点站对应的地铁时间

**当前写死位置**

- 文件：`src/views/Commute.vue`
- 对象：`destinationTravelMinutes`，示例：

destinationTravelMinutes = {
  "真如": { line11: 38, line14: 30 },
  "江苏路": { line11: 42, line14: 34 },
  "封浜": { line11: 50, line14: 25 },
  "陆家嘴": { line11: 60, line14: 40 },
  ...
}**建议 API**

GET /api/commute/destinationTimes  **Response 200**

{
  "code": 0,
  "message": "",
  "data": [
    {
      "station": "真如",
      "lineTimes": {
        "line11": 38,
        "line14": 30
      }
    },
    {
      "station": "封浜",
      "lineTimes": {
        "line11": 50,
        "line14": 25
      }
    }
  ]
}> 前端：`预计总耗时 = lineTime(终点) + 等待接驳 + 步行时间 + 拥挤度惩罚`。

---

### 1.5 终点线路 & 站点下拉选项

**当前写死位置**

- 文件：`src/views/Commute.vue`
- 对象：`lineOptions`、`lineToStations`，示例：

lineOptions = [
  { value: "11号线", label: "11号线" },
  { value: "14号线", label: "14号线" },
  ...
]

lineToStations = {
  "11号线": ["真如", "江苏路", "徐家汇"],
  "14号线": ["真如", "嘉定新城", "封浜"],
  ...
}**建议 API**

GET /api/metro/lines-with-stations**Response 200**

{
  "code": 0,
  "message": "",
  "data": [
    {
      "lineId": "11",
      "lineName": "11号线",
      "stations": [
        { "id": 1101, "name": "安亭" },
        { "id": 1102, "name": "嘉定新城" },
        { "id": 1103, "name": "真如" }
      ]
    },
    {
      "lineId": "14",
      "lineName": "14号线",
      "stations": [
        { "id": 1401, "name": "封浜" },
        { "id": 1402, "name": "真如" }
      ]
    }
  ]
}> Commute 页只需要子集（常用终点），可以在后端打标签或前端自行筛选。

---

## 2. 地铁导航页面（RoutePlanner）

当前前端使用一个**简化网络**做路径搜索：`stations` + `stationConnections` + 前端 Dijkstra。

### 2.1 站点信息

**当前写死位置**

- 文件：`src/views/RoutePlanner.vue`
- 常量：`stations`，包含：

{
  id: 7,
  name: "徐家汇",
  lines: ["1号线", "9号线", "11号线"],
  x: 500,
  y: 100,
  isTransfer: true
}**建议 API**

GET /api/metro/stations**Response 200**

{
  "code": 0,
  "message": "",
  "data": [
    {
      "id": 1,
      "name": "七宝",
      "lines": ["9号线"],
      "lon": 121.366,
      "lat": 31.165,
      "isTransfer": false
    },
    {
      "id": 6,
      "name": "宜山路",
      "lines": ["3号线", "4号线", "9号线"],
      "lon": 121.437,
      "lat": 31.192,
      "isTransfer": true
    }
  ]
}---

### 2.2 邻接关系（站点间的边）

**当前写死位置**

- 文件：`src/views/RoutePlanner.vue`
- 常量：`stationConnections`：

{
  from: 1,
  to: 2,
  line: "9号线",
  time: 2,
  isTransfer: false
}**建议 API**

GET /api/metro/neighbors   **Response 200**

{
  "code": 0,
  "message": "",
  "data": [
    {
      "fromId": 1,
      "toId": 2,
      "line": "9号线",
      "travelMinutes": 2,
      "isTransfer": false
    },
    {
      "fromId": 7,
      "toId": 9,
      "line": "换乘",
      "travelMinutes": 5,
      "isTransfer": true
    }
  ]
}> 前端继续可用这些边在浏览器内跑 Dijkstra；也可以用下面 2.3 的接口由后端直接算。

---

### 2.3 （可选）后端计算最优路径

如果后端倾向集中管理路径算法，可以提供：

GET /api/metro/route   **Query 参数**

- `startStationId`: `number`
- `endStationId`: `number`
- `strategy`: `"time"`（时间最短）或 `"transfer"`（换乘最少）

**Response 200**

{
  "code": 0,
  "message": "",
  "data": {
    "stations": [
      { "id": 1, "name": "七宝", "lines": ["9号线"], "isTransfer": false },
      { "id": 6, "name": "宜山路", "lines": ["3号线", "4号线", "9号线"], "isTransfer": true },
      { "id": 9, "name": "人民广场", "lines": ["1号线", "2号线", "8号线"], "isTransfer": true }
    ],
    "totalMinutes": 32,
    "transferCount": 1
  }
}---

## 3. Dashboard 仪表盘（总览 & 各种图表）

当前 Dashboard 所有数据都是 mock：随机数或写死数组。

### 3.1 今日概览统计

**当前写死位置**

- 文件：`src/views/Dashboard.vue`
- 常量：`statsData`：

[
  { label: "今日客流总量", value: "1256.8万" },
  { label: "实时在线", value: "45.2万" },
  { label: "运营线路", value: "20条" },
  { label: "运营站点", value: "508个" }
]**建议 API**

GET /api/metro/overview/today**Response 200**

{
  "code": 0,
  "message": "",
  "data": {
    "totalPassengerFlow": 1256.8,
    "onlinePassengers": 45.2,
    "lineCount": 20,
    "stationCount": 508,
    "unit": "万人次"
  }
}---

### 3.2 线路列表

**当前写死位置**

- 文件：`src/views/Dashboard.vue`
- 常量：`metroLines`

**建议 API**

GET /api/metro/lines**Response 200**

{
  "code": 0,
  "message": "",
  "data": [
    {
      "lineId": "1",
      "lineName": "1号线 富锦路–莘庄",
      "stationCount": 28,
      "todayFlow": 156.8,
      "status": "正常"     // "正常" | "限流" | "故障" 等
    }
  ]
}---

### 3.3 流量类图表（建议按功能聚合）

当前以下图表的数据全部写死或随机生成：

- 实时进/出站流量曲线（5:00–23:00）
- 时段流量分析（工作日 / 周末）
- 站点客流 TOP10
- 线路流量分布饼图
- OD（热门起终点）
- 分类流量：通勤 C / 居家 HB / 非居家 NHB
- 进站/出站分类柱状图

建议分别设计若干统计接口，形状可以统一为「x 轴数组 + 多个 series 数组」：

GET /api/metro/flow/realtime       // 进出站实时曲线
GET /api/metro/flow/by-hour        // 时段流量（工作日/周末）
GET /api/metro/stations/top        // 站点 TOPN
GET /api/metro/flow/od-top         // OD TOPN
GET /api/metro/flow/category       // C / HB / NHB 分类
GET /api/metro/flow/in-out-category // 进站/出站分类 TOPN

**示例：按小时流量**

{
  "code": 0,
  "message": "",
  "data": {
    "hours": ["05:00", "06:00", "...", "23:00"],
    "workday": [12, 18, 45, 85, 120, 95, 80],
    "weekend": [8, 12, 20, 35, 50, 65, 75]
  }
}---

> 如需，我可以在这份 API 规格的基础上再给一版数据库表结构建议，例如：
> 
> - `metro_station` / `metro_line` / `metro_station_line`
> - `metro_edge`（站点邻接）
> - `commute_schedule`（DZ1/822 等时刻表）
> - `metro_flow_stat_hourly`（每小时流量）
> - `metro_od_flow`（OD 统计）

![](C:\Users\Tshow\AppData\Roaming\marktext\images\2025-12-24-08-54-20-image.png)

![](C:\Users\Tshow\AppData\Roaming\marktext\images\2025-12-24-08-54-26-image.png)

![](C:\Users\Tshow\AppData\Roaming\marktext\images\2025-12-24-08-54-31-image.png)

![](C:\Users\Tshow\AppData\Roaming\marktext\images\2025-12-24-08-54-39-image.png)

![](C:\Users\Tshow\AppData\Roaming\marktext\images\2025-12-24-08-54-46-image.png)

![](C:\Users\Tshow\AppData\Roaming\marktext\images\2025-12-24-08-54-53-image.png)

![](C:\Users\Tshow\AppData\Roaming\marktext\images\2025-12-24-08-54-59-image.png)

![](C:\Users\Tshow\AppData\Roaming\marktext\images\2025-12-24-08-55-07-image.png)

![](C:\Users\Tshow\AppData\Roaming\marktext\images\2025-12-24-08-55-14-image.png)

![](C:\Users\Tshow\AppData\Roaming\marktext\images\2025-12-24-08-55-20-image.png)
